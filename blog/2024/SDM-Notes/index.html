<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Notes of Score Diffusion Models (updating) | Yiming Che (车一鸣) </title> <meta name="author" content="Yiming Che"> <meta name="description" content="basics of score diffusion models"> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/che.jpg?cb45d92e8d9c4d4cdb80894d70e4a1ef"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://soloche.github.io/blog/2024/SDM-Notes/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> Yiming Che (车一鸣) </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Notes of Score Diffusion Models (updating)</h1> <p class="post-meta"> Created in September 24, 2024 </p> <p class="post-tags"> <a href="/blog/2024"> <i class="fa-solid fa-calendar fa-sm"></i> 2024 </a>   ·   <a href="/blog/tag/bayes"> <i class="fa-solid fa-hashtag fa-sm"></i> Bayes</a>   <a href="/blog/tag/deep-learning"> <i class="fa-solid fa-hashtag fa-sm"></i> Deep-Learning</a>   <a href="/blog/tag/diffusion-model"> <i class="fa-solid fa-hashtag fa-sm"></i> Diffusion-Model</a> </p> </header> <article class="post-content"> <div id="markdown-content"> <p><strong>Table of Contents</strong></p> <ul> <li><a href="#unified-framework-by-stochastic-differential-equations-sde">Unified Framework by Stochastic Differential Equations (SDE)</a></li> <li> <a href="#background">Background</a> <ul> <li><a href="#data-perturbation-with-it%C3%B4-sde">Data Perturbation with Itô SDE</a></li> <li><a href="#reverse-sde">Reverse SDE</a></li> <li><a href="#probability-flow-ode">Probability Flow ODE</a></li> </ul> </li> </ul> <h1 id="unified-framework-by-stochastic-differential-equations-sde">Unified Framework by Stochastic Differential Equations (SDE)</h1> <p>In <a href="https://arxiv.org/abs/2011.13456" rel="external nofollow noopener" target="_blank">Score-Based Generative Modeling through Stochastic Differential Equations</a>, the authors propose a unified framework that connects the score-based model NCSN and DDPM through the perspective of Stochastic Differential Equations (SDE). They interpret the forward process (adding noise) and the backward process (denoising sampling) as SDE and reverse SDE, respectively.</p> <h1 id="background">Background</h1> <h2 id="data-perturbation-with-itô-sde">Data Perturbation with Itô SDE</h2> <p>The diffusion process ${\x_t}_{t=0}^T$ from the original input $\x_0$ to Gaussian noise $\x_T$ with continuous time variable $t\in\sbr{0,T}$ can be modeled by the Itô SDE \(\begin{equation} d\x = \f(\x, t) dt + g(t)d\w_t \end{equation}\)</p> <ul> <li>$\w_t$ is the standard Wiener process.</li> <li>$\f(\x,t): \mathbb{R}^d \rightarrow \mathbb{R}^d$ are the drift coefficients and $d$ is the dimension of $\x$. It is always affine, resulting in $f(\x, t) = f(t)\x$ where $f(\cdot):\mathbb{R} \rightarrow \mathbb{R}$.</li> <li>$g(t): \mathbb{R} \rightarrow \mathbb{R}$ are the diffusion coefficients at time $t$.</li> </ul> <p>Then, Eq. (1) can be rewritten as \(\begin{equation} d\x = f(t)\x dt + g(t)d\w_t \end{equation}\)</p> <p>The perturbation kernel of this SDE have the form</p> \[\begin{equation} p(\x_t \mid \x_0) = \N(\x_t \mid s_t\x_0, s_t^2\sigma_t^2\I) \end{equation}\] <p>where</p> \[\begin{equation} s_t = \exp\nbr{\int_0^t f(\xi)d\xi} \quad \text{and}\quad \sigma_t^2 = \int_0^t\nbr{\frac{g(\xi)}{s(\xi)}}^2d\xi \end{equation}\] <p>Here, I’ll use $s_t$ and $s(t)$, and $\sigma_t$ and $\sigma(t)$ interchangeably for simplicity. The corresponding marginal distribution is obtained by</p> \[\begin{align} p(\x_t) &amp;= \int p(\x_t \mid \x_0)p_{data}(\x_0)d\x_0\\ &amp;= s_t^{-d}\int p_{data}(\x_0)\N(\x_ts_t^{-1} \mid \x_0, \sigma_t^2\I)d\x_0\\ &amp;= s_t^{-d}\int p_{data}(\x_0)\N(\x_ts_t^{-1}-\x_0 \mid 0, \sigma_t^2\I)d\x_0\\ &amp;= s_t^{-d} \sbr{p_{data}(\x_0) * \N\nbr{0, \sigma_t^2\I}}(\x_ts_t^{-1})\\ &amp;= s_t^{-d} p(\x_ts_t^{-1};\sigma_t) \end{align}\] <h2 id="reverse-sde">Reverse SDE</h2> <p>The reverse diffusion process from $\x_T$ to $\x_0$ can also be modeled by the Itô SDE</p> \[\begin{equation} d\x = \sbr{f(t)\x - g_t^2\nabla_{\x}\log p(\x_t)}dt + g(t)d\w_t \end{equation}\] <h2 id="probability-flow-ode">Probability Flow ODE</h2> <p>According to the <a href="https://en.wikipedia.org/wiki/Fokker%E2%80%93Planck_equation" rel="external nofollow noopener" target="_blank">Fokker-Plank equation</a>, there exists a ODE which shares the same marginal distribution $p(\x_t)$ as the SDE. The ODE is called the probability flow ODE and is given by</p> \[\begin{equation} d\x = \sbr{f(t)\x - \frac{1}{2}g_t^2\nabla_{\x}\log p(\x)}dt \end{equation}\] <p>If we further build the ODE according to $s_t$ and $\sigma_t$, we have</p> \[\begin{equation} f(t) = \dot{s}_ts_t^{-1} \quad \text{and} \quad g_t = s_t\sqrt{2\dot{\sigma}_t\sigma_t}. \end{equation}\] <p>The derivation can be found in EDM paper (Eq. 28 and 34). Then, Eq. (10) can be rewritten as</p> \[\begin{align} d\x &amp;= \sbr{\dot{s}_ts_t^{-1}\x - s_t^2\dot{\sigma}_t\sigma_t\nabla_{\x}\log p(\x)}dt\\ &amp;= \sbr{\dot{s}_ts_t^{-1}\x - s_t^2\dot{\sigma}_t\sigma_t\nabla_{\x}\log p(\x s_t^{-1};\sigma_t)}dt \end{align}\] <p>where the last step is due to the marginal $p(\x_t) = s^{-1}<em>t p(\x_ts_t^{-1};\sigma_t)$ where $p(\x_ts_t^{-1};\sigma_t) = \sbr{p</em>{data}(\x_0) * \N\nbr{0, \sigma_t^2\I}}(\x_ts_t^{-1})$.</p> </div> </article> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2024 Yiming Che. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. Last updated: September 24, 2024. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?06cae41083477f121be8cd9797ad8e2f"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams",packages:{"[+]":["configmacros"]},macros:{R:"{\\mathbb{R}}",f:"{\\bf f}",w:"{\\boldsymbol{w}}",x:"{\\boldsymbol{x}}",I:"{\\boldsymbol{I}}",nbr:["\\left(#1\\right)",1],sbr:["\\left[#1\\right]",1],bm:["\\boldsymbol{#1}",1],bs:["\\boldsymbol{#1}",1],N:"{\\mathcal{N}}",argmax:["\\underset{#1}{\\operatorname{argmax}}",1],argmin:["\\underset{#1}{\\operatorname{argmin}}",1]},inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]]}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script src="/assets/js/shortcut-key.js"></script> </body> </html>